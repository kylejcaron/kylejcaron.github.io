<!-- ---
layout: post
title:  "Common Misconceptions with Multicollinearity"
image: "../../assets/img/placeholder.png"
date: "2025-03-06"
categories:
 - multicollinearity
 - causal inference
 - regression
---


```{python}
import pandas as pd
from statsmodels.stats.outliers_influence import variance_inflation_factor as vif
import statsmodels.api as sm

N = 250
SIG = 0.5
TRUE_EFFECT = 0.7

rng = np.random.default_rng(99)
data = (pd.DataFrame({"x1":rng.normal(0, 1, size=N), "x2":rng.normal(0, 1, size=N)})
        .assign(x3=lambda d: rng.normal(1.1 + d.x1*3.8, SIG))
        .assign(y = lambda d: rng.normal(0.5 + d.x1*-4 + d.x2*-0.5 + d.x3*TRUE_EFFECT, SIG))
)
X = data.filter(like='x')
display(
    pd.DataFrame({
    "VIF": [vif(X.values, i) for i in range(X.shape[1])]
}, index=X.columns).round(2)
)

X.corr()

m1 = sm.OLS.from_formula("y ~ x2 + x3",data=data).fit()
m2 = sm.OLS.from_formula("y ~ x1 + x2 + x3",data=data).fit()

def get_ci95(model):
    lb = (model.params - model.bse*2)
    ub = model.params + model.bse*2
    return lb, ub

lb, ub = get_ci95(m1)
plt.hlines(0, lb.loc['x3'], ub.loc['x3'], lw=2, label='VIF Adjusted Model', color='C1')
plt.scatter(m1.params.loc['x3'], 0, facecolor='white', edgecolor='C1', zorder=10, s=10)

lb, ub = get_ci95(m2)
plt.hlines(1, lb.loc['x3'], ub.loc['x3'], lw=2, label='Causally informed model')
plt.scatter(m2.params.loc['x3'], 1, facecolor='white', edgecolor='C0',zorder=10, s=10)

plt.axvline(0, ls='--', color='k')
plt.axvline(TRUE_EFFECT, color='r', ls='--', lw=1, label='True Effect')
plt.xlim(-1, 1)
plt.ylim(-1,2)
plt.yticks([])
plt.xlabel("Beta Coefficient")
plt.legend()
plt.show()
``` -->